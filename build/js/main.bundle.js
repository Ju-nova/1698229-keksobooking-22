(()=>{"use strict";const e=35.68955,t=139.69222,o=document.querySelector(".map__filters"),r=o.querySelector("#housing-type"),n=o.querySelector("#housing-price"),a=o.querySelector("#housing-rooms"),c=o.querySelector("#housing-guests"),l=o.querySelector("#housing-features"),s={low:[0,1e4],middle:[1e4,5e4],high:[5e4,1e6],any:[0,1e6]},i=(e,t)=>t[e%100>4&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]],d=e=>"Enter"===e.key,u=e=>"Escape"===e.key||"Esc"===e.key,f=(e,t)=>{e.innerHTML=t.innerHTML,e.removeAttribute("style")},p=document.querySelector("main"),m=document.querySelector("#success").content.querySelector(".success"),y=document.querySelector("#error").content.querySelector(".error"),v=document.querySelector("#card").content.querySelector(".popup"),h=e=>{const t=v.cloneNode(!0),o=t.querySelector(".popup__avatar");e.author.avatar?o.src=e.author.avatar:o.remove();const r=t.querySelector(".popup__title");e.offer.title?r.textContent=e.offer.title:r.remove();const n=t.querySelector(".popup__text--address");e.offer.address?n.textContent=e.offer.address:n.remove();const a=t.querySelector(".popup__text--price");e.offer.price?a.textContent=`${e.offer.price} ₽/ночь`:a.remove();const c=t.querySelector(".popup__type");e.offer.type?c.textContent=e.offer.type:c.remove();const l=t.querySelector(".popup__text--capacity");e.offer.rooms&&e.offer.guests?l.textContent=`${e.offer.rooms} ${i(e.offer.rooms,["комната","комнаты","комнаты"])}\n   для ${e.offer.guests} ${i(e.offer.guests,["гостя","гостей","гостей"])}`:l.remove();const s=t.querySelector(".popup__text--time");e.offer.checkin&&e.offer.checkout?s.textContent=`Заезд после  ${e.offer.checkin},\n   выезд до ${e.offer.checkout}`:s.remove();const d=t.querySelector(".popup__description");e.offer.description?d.textContent=e.offer.description:d.remove();const u=t.querySelector(".popup__features");if(e.offer.features){u.innerHTML="";for(let t=0;t<e.offer.features.length;t++){const o=document.createElement("li"),r=`popup__feature--${e.offer.features[t]}`;o.classList.add("popup__feature",r),u.appendChild(o)}}else u.remove();const f=t.querySelector(".popup__photos");if(e.offer.photos){f.innerHTML="";for(let t=0;t<e.offer.photos.length;t++){const o=v.querySelector(".popup__photo").cloneNode(!0);o.src=e.offer.photos[t],f.appendChild(o)}}else f.remove();return t},g={iconUrl:"img/main-pin.svg",iconSize:[50,82],iconAnchor:[25,82]},S={iconUrl:"img/pin.svg",iconSize:[25,41],iconAnchor:[13,41]},q=document.querySelector("#address"),E=document.querySelector(".ad-form").querySelector(".ad-form__reset"),x=()=>{q.value="35.68955 , 139.69222"},b=L.map("map-canvas"),k=L.icon({iconUrl:g.iconUrl,iconSize:g.iconSize,iconAnchor:g.iconAnchor}),C=L.marker({lat:e,lng:t},{draggable:!0,icon:k}),w=[],A=(e,t,o)=>{for(let r=0;r<o;r++){const o=t[r],{location:n}=o,a=L.icon({iconUrl:S.iconUrl,iconSize:S.iconSize,iconAnchor:S.iconAnchor}),c=L.marker({lat:n.lat,lng:n.lng},{icon:a});c.addTo(e).bindPopup(h(o)),w.push(c)}return w},$=e=>e.forEach((e=>e.remove())),z=async()=>{K(),b.on("load",(()=>{X()})).setView({lat:e,lng:t},10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(b),C.addTo(b),q.setAttribute("readonly","true"),x(),C.on("move",(e=>{const t=e.target.getLatLng();q.value=`${t.lat.toFixed(5)}, ${t.lng.toFixed(5)}`}));try{const e=await fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(e.ok)return e.json();G()}));((e,t)=>{let i="any",d="any",u="any",f="any",p=[],m=t;var y;y=_.debounce((()=>(()=>{$(e);const t=m.length<10?m.length:10;e=A(b,m,t)})()),500),o.addEventListener("change",(()=>{y()}));const v=()=>m=t.filter((e=>((e,t)=>"any"===t||e.offer.type===t)(e,i))).filter((e=>((e,t)=>e.offer.price>=s[t][0]&&e.offer.price<s[t][1]||"any"===t)(e,d))).filter((e=>((e,t)=>"any"===t||t===String(e.offer.rooms))(e,u))).filter((e=>((e,t)=>"any"===t||t===String(e.offer.guests))(e,f))).filter((e=>((e,t)=>{for(const o of t)if(!e.offer.features.includes(o))return!1;return!0})(e,p)));r.addEventListener("change",(e=>{i=e.target.value,v()})),n.addEventListener("change",(e=>{d=e.target.value,v()})),a.addEventListener("change",(e=>{u=e.target.value,v()})),c.addEventListener("change",(e=>{f=e.target.value,v()})),l.addEventListener("change",(()=>{p=Array.from(l.querySelectorAll("input:checked")).map((e=>e.value)),v()}))})(A(b,e,10),e)}catch(e){(e=>{const t=document.createElement("div"),o=document.querySelector(".map__canvas");t.style.position="fixed",t.style.left="0",t.style.right="0",t.style.zIndex="1000",t.style.margin="0 auto",t.style.padding="20px",t.style.textAlign="center",t.style.maxWidth="600px",t.style.backgroundColor="white",t.style.border="4px solid red",t.style.fontSize="20px",t.textContent="Данные не пришли с сервера. Обновите страницу",o.appendChild(t)})()}E.addEventListener("click",(e=>{e.preventDefault(),ve()}))},T=["gif","jpg","jpeg","png"],V=document.querySelector(".ad-form-header__input"),j=document.querySelector(".ad-form__input"),U=document.querySelector(".ad-form-header__preview"),H=document.querySelector(".ad-form__photo"),D=U.cloneNode(!0),M=H.cloneNode(!0),N=(e,t)=>{const o=e.files[0];if((e=>T.some((t=>e.endsWith(t))))(o.name.toLowerCase())){const e=new FileReader;e.addEventListener("load",(()=>{t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.minWidth=t.offsetWidth+"px",t.innerHTML="";const o=document.createElement("img");o.src=e.result,o.style.maxWidth=t.offsetWidth+"px",o.style.maxHeight=t.offsetHeight+"px",t.appendChild(o)})),e.readAsDataURL(o)}};V.addEventListener("change",(()=>{N(V,U)})),j.addEventListener("change",(()=>{N(j,H)}));const W=["12:00","13:00","14:00"],O={1:[1],2:[1,2],3:[1,2,3],100:[0]},F=document.querySelector(".ad-form"),I=e=>{for(let t=0;t<e.length;t++)e[t].disabled=!0},P=document.querySelector(".map__filters"),R=P.querySelectorAll(".map__filter"),B=P.querySelector(".map__features"),G=()=>{P.classList.add("ad-form--disabled"),P.disabled=!0,I(R),I(B)},J=F.querySelectorAll("fieldset"),K=()=>{F.classList.add("ad-form--disabled"),G(),I(J)},Q=e=>{for(let t=0;t<e.length;t++)e[t].disabled=!1},X=()=>{F.classList.remove("ad-form--disabled"),P.classList.remove("ad-form--disabled"),P.disabled=!1,Q(R),Q(B),Q(J)},Y={bungalow:0,flat:1e3,house:5e3,palace:1e4},Z=Object.keys(Y),ee=Object.values(Y),te=F.querySelector("#price"),oe=F.querySelector("#type"),re=()=>{for(let e=0;e<Z.length;e++)oe.value===Z[e]&&(te.placeholder=ee[e],te.min=ee[e])},ne=F.querySelector("#timein"),ae=F.querySelector("#timeout"),ce=()=>{for(let e=0;e<W.length;e++)ne.value===W[e]&&(ae.value=W[e])},le=()=>{for(let e=0;e<W.length;e++)ae.value===W[e]&&(ne.value=W[e])},se=F.querySelector("#room_number"),ie=se.value,de=F.querySelector("#capacity").querySelectorAll("option"),ue=e=>{const t=O[e.target.value];de.forEach((e=>{e.disabled=!0,e.selected=!1,t.forEach((t=>{+e.value==+t&&(e.disabled=!1,e.selected=!0)}))}))},fe=oe.querySelector("option:checked").value,pe=()=>{(()=>{for(let e=0;e<Z.length;e++)fe===Z[e]&&(te.placeholder=ee[e],te.min=ee[e])})(),ne.addEventListener("change",ce),ae.addEventListener("change",le),oe.addEventListener("change",re),(()=>{const e=O[ie];de.forEach((t=>{t.disabled=!0,t.selected=!1,e.forEach((e=>{+t.value==+e&&(t.disabled=!1,t.selected=!0)}))}))})(),se.addEventListener("change",ue)},me=document.querySelector("#title"),ye=document.querySelector(".map__filters"),ve=()=>{F.reset(),(async()=>{w.forEach((e=>{e.remove()})),z(),X()})(),ye.reset(),x(),pe(),f(U,D),f(H,M),b.setView(new L.LatLng(e,t),10),C.setLatLng(new L.LatLng(e,t))};var he,ge;pe(),me.addEventListener("input",(()=>{const e=me.value.length;e<30?me.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?me.setCustomValidity("Удалите лишние "+(e-100)+" симв."):me.setCustomValidity(""),me.reportValidity()})),te.addEventListener("input",(()=>{const e=te.validity;e.rangeOverflow?te.setCustomValidity(`Максимум ${te.max} , больше нельзя`):e.rangeUnderflow?te.setCustomValidity(`Минимум ${te.min} , меньше нельзя`):te.setCustomValidity(""),te.reportValidity()})),z(),he=()=>{const e=m.cloneNode(!0);e.style.zIndex="1000",p.appendChild(e),e.addEventListener("click",(()=>{e.remove()})),e.removeEventListener("click",(()=>{e.remove()})),document.addEventListener("keydown",(t=>{u(t)&&(t.preventDefault(),e.remove())})),document.removeEventListener("keydown",(t=>{u(t)&&(t.preventDefault(),e.remove())})),setTimeout((()=>{e.remove()}),5e3)},ge=()=>{const e=y.cloneNode(!0);e.style.zIndex="1000",p.appendChild(e);const t=e.querySelector(".error__button");t.addEventListener("click",(()=>e.remove())),t.removeEventListener("click",(()=>e.remove())),t.addEventListener("keydown",(t=>{d(t)&&e.remove()})),t.removeEventListener("keydown",(t=>{d(t)&&e.remove()}))},F.addEventListener("submit",(e=>{var t,o;e.preventDefault(),t=()=>ge(),o=new FormData(e.target),fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:o}).then((e=>{e.ok?(he(),ve()):t()})).catch((()=>{t()}))}))})();
//# sourceMappingURL=main.bundle.js.map